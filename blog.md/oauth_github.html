<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Github OAuth2.0 的使用 | Ravenq 的技术博客</title>
    <meta name="description" content="Ravenq 的技术博客文章在Github的备份，博客请访问 http://www.aqcoder.com">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script src="/baidu-tongji.js"></script>
    
    <link rel="preload" href="/assets/css/0.styles.3e1d0bd1.css" as="style"><link rel="preload" href="/assets/js/app.449482ac.js" as="script"><link rel="preload" href="/assets/js/38.9f145b9a.js" as="script"><link rel="prefetch" href="/assets/js/10.1795415c.js"><link rel="prefetch" href="/assets/js/11.5697271d.js"><link rel="prefetch" href="/assets/js/12.2d1a74e9.js"><link rel="prefetch" href="/assets/js/13.1108ff19.js"><link rel="prefetch" href="/assets/js/14.512762b4.js"><link rel="prefetch" href="/assets/js/15.bfc1ab71.js"><link rel="prefetch" href="/assets/js/16.0401e727.js"><link rel="prefetch" href="/assets/js/17.d64902bb.js"><link rel="prefetch" href="/assets/js/18.7f5c768d.js"><link rel="prefetch" href="/assets/js/19.2af6154c.js"><link rel="prefetch" href="/assets/js/2.e3d0b74a.js"><link rel="prefetch" href="/assets/js/20.2cf9bef6.js"><link rel="prefetch" href="/assets/js/21.8f268dda.js"><link rel="prefetch" href="/assets/js/22.1f8e08d7.js"><link rel="prefetch" href="/assets/js/23.7fdf7ab7.js"><link rel="prefetch" href="/assets/js/24.66c5a86a.js"><link rel="prefetch" href="/assets/js/25.a83dfd76.js"><link rel="prefetch" href="/assets/js/26.11087a83.js"><link rel="prefetch" href="/assets/js/27.1f760240.js"><link rel="prefetch" href="/assets/js/28.ee501b2c.js"><link rel="prefetch" href="/assets/js/29.188e0462.js"><link rel="prefetch" href="/assets/js/3.36e5b5e1.js"><link rel="prefetch" href="/assets/js/30.19240d18.js"><link rel="prefetch" href="/assets/js/31.3d405e92.js"><link rel="prefetch" href="/assets/js/32.999b2d9c.js"><link rel="prefetch" href="/assets/js/33.cb25df01.js"><link rel="prefetch" href="/assets/js/34.cfda36ac.js"><link rel="prefetch" href="/assets/js/35.d4f428c5.js"><link rel="prefetch" href="/assets/js/36.2e0e81b6.js"><link rel="prefetch" href="/assets/js/37.81c83033.js"><link rel="prefetch" href="/assets/js/39.a995a87f.js"><link rel="prefetch" href="/assets/js/4.fd104560.js"><link rel="prefetch" href="/assets/js/40.a8339f78.js"><link rel="prefetch" href="/assets/js/41.303966bd.js"><link rel="prefetch" href="/assets/js/5.c452f593.js"><link rel="prefetch" href="/assets/js/6.8ff2dce6.js"><link rel="prefetch" href="/assets/js/7.3c05d30c.js"><link rel="prefetch" href="/assets/js/8.487a6da2.js"><link rel="prefetch" href="/assets/js/9.ec32e0e8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3e1d0bd1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Ravenq 的技术博客</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.aqcoder.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.github.com/ravenq/markdown-it-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  markdown-it-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.github.com/ravenq/vue-cli-plugin-component-lib" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue-cli-plugin-component-lib
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><h4>GVF Project</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.github.com/ravenq/gvf-server" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gvf-server
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.github.com/ravenq/gvf-client" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gvf-client
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.github.com/ravenq/gvf-admin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gvf-admin
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/ravenq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.aqcoder.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.github.com/ravenq/markdown-it-vue" target="_blank" rel="noopener noreferrer" class="nav-link external">
  markdown-it-vue
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://www.github.com/ravenq/vue-cli-plugin-component-lib" target="_blank" rel="noopener noreferrer" class="nav-link external">
  vue-cli-plugin-component-lib
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><h4>GVF Project</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.github.com/ravenq/gvf-server" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gvf-server
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.github.com/ravenq/gvf-client" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gvf-client
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://www.github.com/ravenq/gvf-admin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  gvf-admin
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/ravenq" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Github OAuth2.0 的使用</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog.md/oauth_github.html#oath2-0-流程" class="sidebar-link">OAth2.0 流程</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog.md/oauth_github.html#注册-github-application" class="sidebar-link">注册 Github Application</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog.md/oauth_github.html#前端获取-code-state" class="sidebar-link">前端获取 code &amp; state</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog.md/oauth_github.html#拿着-code-传给后端，从后端获取-access-token" class="sidebar-link">拿着 code 传给后端，从后端获取 access_token</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog.md/oauth_github.html#用-access-token-获取用户信息" class="sidebar-link">用 access_token 获取用户信息</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog.md/oauth_github.html#最后" class="sidebar-link">最后</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="github-oauth2-0-的使用"><a href="#github-oauth2-0-的使用" aria-hidden="true" class="header-anchor">#</a> Github OAuth2.0 的使用</h1> <blockquote><p>原文：<a href="http://www.aqcoder.com/post/content?id=37" target="_blank" rel="noopener noreferrer">http://www.aqcoder.com/post/content?id=37<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>最近想为自己的博客增加一个评论功能。多说已经倒下了，畅言需要网站备案，isso 看起来也不是很好用，算了，自己折腾一个吧。</p> <p>评论系统其实还是又很多复杂的地方的，不能简单的画一个表单完事，会有很多垃圾评论的 →_→。我的博客系统暂时没有用户系统，一次需要一个第三方登录。</p> <p>第三方登录有 OAuth 2.0 标准，什么是 OAuth 2.0 请参考阮一峰老师的文章 <a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html%E3%80%82" target="_blank" rel="noopener noreferrer">http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html。<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>为什么使用 Github ？ 因为 QQ、微信的第三方登录都需要你的域名有备案，而且需要企业用户才能接入，也就是说你的现有个公司 →<em>→。考虑到技术博客会看的都是码农们，还是用 Github 吧，毕竟。。。也是全球最大的搞基网站了 →</em>→。</p> <h2 id="oath2-0-流程"><a href="#oath2-0-流程" aria-hidden="true" class="header-anchor">#</a> OAth2.0 流程</h2> <p>为了方便描述，我们这边画一个大致的 OAuth2.0 的流程图。</p> <div class="language-sh extra-class"><pre class="language-text"><code> 前端                 后端                      后端             后端
 -—---------      ----------------------     -------------     ----------
| Client ID | --&gt;| code + Client Secret |--&gt;|access_token |--&gt;| user info |
 -----------      ----------------------     ------------      ----------
</code></pre></div><p>具体也可以查阅 Github 官方文档 <a href="https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/" target="_blank" rel="noopener noreferrer">https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="注册-github-application"><a href="#注册-github-application" aria-hidden="true" class="header-anchor">#</a> 注册 Github Application</h2> <p>使用 Github 第三方登录，首先需要注册一个 Github Application.</p> <p><img src="https://ravenq-1251588610.cos.ap-guangzhou.myqcloud.com/oauth-github-1.png" alt="github settings"></p> <p><img src="https://ravenq-1251588610.cos.ap-guangzhou.myqcloud.com/oauth-github-2.png" alt="github application"></p> <p><img src="https://ravenq-1251588610.cos.ap-guangzhou.myqcloud.com/oauth-github-3.png" alt="github new application"></p> <p><img src="https://ravenq-1251588610.cos.ap-guangzhou.myqcloud.com/oauth-github-4.png" alt="github new application form"></p> <p><img src="https://ravenq-1251588610.cos.ap-guangzhou.myqcloud.com/oauth-github-5.png" alt="github application id & skey"></p> <p>按照步骤注册后可以得到 ClientId 和 Client Secret。</p> <p>最后需要设置一下回调地址。</p> <p><img src="https://ravenq-1251588610.cos.ap-guangzhou.myqcloud.com/oauth-github-6.png" alt="github callback url"></p> <h2 id="前端获取-code-state"><a href="#前端获取-code-state" aria-hidden="true" class="header-anchor">#</a> 前端获取 code &amp; state</h2> <p>根据 OAuth2.0 规范，第一步是根据 ClientId 获取到 code(后面需要这个 code + SecretID 换取access_token)。</p> <p>获取 code 的步骤很简单，只要拼接好一个 URL 访问，带用户操作完成后，Github 会重定向会第一步中设置的回调地址。</p> <div class="language-sh extra-class"><pre class="language-text"><code>https://github.com/login/oauth/authorize?client_id=your_client_id&amp;redirect_uri=your_callback_url&amp;scope=user&amp;state=random_string
</code></pre></div><p>具体 URL 参数如下：</p> <table><thead><tr><th>name</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>client_id</td> <td>string</td> <td>第一步中注册得到的ClientID</td></tr> <tr><td>redirect_uri</td> <td>string</td> <td>第一步中设置的回调地址</td></tr> <tr><td>loin</td> <td>string</td> <td>推荐登录的 Github 账户，一般不填</td></tr> <tr><td>scope</td> <td>string</td> <td>这个参数指定了最后能获取到的信息，取值范围有 user 和 repo 等等,默认同时取 user 和 repo 的信息，详细取值范围见<a href="https://developer.github.com/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/" target="_blank" rel="noopener noreferrer">Github 文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td></tr> <tr><td>state</td> <td>string</td> <td>你设定的一个随机值，用来防止 cross-sit 攻击</td></tr> <tr><td>allow_signup</td> <td>string</td> <td>这个参数指定是否允许用户在认证的时候注册 Github 账号，默认是 true</td></tr></tbody></table> <p>如下是我的博客的前端代码示例：</p> <div class="language-js extra-class"><pre class="language-js"><code>methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'setUser'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">loginWithGithub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>spinning <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">const</span> oauthUri <span class="token operator">=</span> <span class="token constant">GITHUB</span><span class="token punctuation">.</span><span class="token constant">OAUTH_URI</span>
    <span class="token keyword">const</span> redirectUri <span class="token operator">=</span> <span class="token constant">GITHUB</span><span class="token punctuation">.</span><span class="token constant">REDIRECT_URI</span>
    <span class="token keyword">const</span> clientId <span class="token operator">=</span> <span class="token constant">GITHUB</span><span class="token punctuation">.</span><span class="token constant">CLIENT_ID</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>oauthUri<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?client_id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>clientId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;redirect_uri=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>redirectUri<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;scope=user&amp;state=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
    window<span class="token punctuation">.</span><span class="token function-variable function">loginWithGithub</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> vertifyState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$api<span class="token punctuation">.</span><span class="token function">LoginWithGithub</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> vertifyState<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> user <span class="token operator">=</span> res<span class="token punctuation">.</span>data
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>spinning <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> myWindow <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>
      url<span class="token punctuation">,</span>
      <span class="token string">'aqcoder.com-login-github'</span><span class="token punctuation">,</span>
      <span class="token string">'modal=yes,toolbar=no,titlebar=no,menuba=no,location=no,top=200,left=500,width=600,height=400'</span>
    <span class="token punctuation">)</span>
    myWindow<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isAuthenticated<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'登录超时'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>spinning <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">60000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里我们没有使用 <code>&lt;a&gt;</code>标签，因为我的博客前端是用 Vue 构建的单页应用，如果使用<code>&lt;a&gt;</code>标签会存在跳转问题，所以我这里使用了<code>window.open</code> 弹出一个网页，待 Github 回调后，在会用<code>window.opener.loginGithub</code>调用回来。这样不会跳转网页，会比较平滑。</p> <p>回调地址也的代码如下：</p> <p>login-github.vue</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">import</span> isNil <span class="token keyword">from</span> <span class="token string">'lodash.isnil'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  layout<span class="token punctuation">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
  <span class="token function">beforeRouteEnter</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">vm</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> code <span class="token operator">=</span> to<span class="token punctuation">.</span>query<span class="token punctuation">.</span>code
      <span class="token keyword">const</span> state <span class="token operator">=</span> to<span class="token punctuation">.</span>query<span class="token punctuation">.</span>state
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNil</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>opener<span class="token punctuation">.</span><span class="token function">loginWithGithub</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> state<span class="token punctuation">)</span>
        window<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">onblur</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>详细代码可以见我的博客前端代码： <a href="http://www.github.com/ravenq/gvf-client" target="_blank" rel="noopener noreferrer">http://www.github.com/ravenq/gvf-client<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="拿着-code-传给后端，从后端获取-access-token"><a href="#拿着-code-传给后端，从后端获取-access-token" aria-hidden="true" class="header-anchor">#</a> 拿着 code 传给后端，从后端获取 access_token</h2> <p>第二步就是用 code + Client Secret 获取 access_token 了。那这一步为什么要在后端做呢，可能有的同学是存 Vue 应用，没有后端会有这个疑问。其实这一不要挪到后端做的理由很简单。</p> <p><code>Client Secret</code> 不能暴露给在前端网页，否则会有人拿着你的 <code>Client Secret</code> 干一些非法勾当，所以这一步只能放到后端。放在前端人家一个 F12 啥都看到了。</p> <p>获取access_token 的接口同样是 http 协议, 这样各个语言不需要 SDK 都可以直接使用。</p> <div class="language-url extra-class"><pre class="language-text"><code>POST https://github.com/login/oauth/access_token
</code></pre></div><p>具体参数如下:</p> <table><thead><tr><th>Name</th> <th>Type</th> <th>Description</th></tr></thead> <tbody><tr><td>client_id</td> <td>string</td> <td>第一步中获取到的 ClientID</td></tr> <tr><td>cleint_secret</td> <td>string</td> <td>第一步中获取到的 ClientSecret</td></tr> <tr><td>code</td> <td>string</td> <td>第二步中前端获取到的 code</td></tr> <tr><td>redirect_uri</td> <td>string</td> <td>第一步中设置的回调地址</td></tr> <tr><td>state</td> <td>string</td> <td>第一步中设置的随机值</td></tr></tbody></table> <p>接口的返回值会根据你的 http 头部的 <code>Accept</code> 的值返回不同的格式</p> <p>application/x-www-form-urlencoded</p> <div class="language-sh extra-class"><pre class="language-text"><code>access_token=e72e16c7e42f292c6912e7710c838347ae178b4a&amp;token_type=bearer
</code></pre></div><p>application/json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;access_token&quot;</span><span class="token operator">:</span> <span class="token string">&quot;e72e16c7e42f292c6912e7710c838347ae178b4a&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scope&quot;</span><span class="token operator">:</span> <span class="token string">&quot;repo,gist&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;token_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bearer&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>application/xml</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OAuth</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>token_type</span><span class="token punctuation">&gt;</span></span>bearer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>token_type</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>repo,gist<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>access_token</span><span class="token punctuation">&gt;</span></span>e72e16c7e42f292c6912e7710c838347ae178b4a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>access_token</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>OAuth</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>下面是我的博客祸端代码，使用 Golang 编写，详细见我的博客后端项目 <a href="http://www.github.com/ravenq/gvf-server" target="_blank" rel="noopener noreferrer">http://www.github.com/ravenq/gvf-server<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-go extra-class"><pre class="language-go"><code>  <span class="token keyword">var</span> v <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span>
  json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>RequestBody<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v<span class="token punctuation">)</span>
  code <span class="token operator">:=</span> v<span class="token punctuation">[</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">]</span>
  state <span class="token operator">:=</span> v<span class="token punctuation">[</span><span class="token string">&quot;state&quot;</span><span class="token punctuation">]</span>
  clientID <span class="token operator">:=</span> beego<span class="token punctuation">.</span>AppConfig<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;GITHUB_CLIENT_ID&quot;</span><span class="token punctuation">)</span>
  clientSecret <span class="token operator">:=</span> beego<span class="token punctuation">.</span>AppConfig<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;GITHUB_CLIENT_SECRET&quot;</span><span class="token punctuation">)</span>

  req <span class="token operator">:=</span> httplib<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/login/oauth/access_token&quot;</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;client_id&quot;</span><span class="token punctuation">,</span> clientID<span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;client_secret&quot;</span><span class="token punctuation">,</span> clientSecret<span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;state&quot;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">&quot;Accept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>

  <span class="token keyword">var</span> accRet GithubAccessResult
  err <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">ToJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>accRet<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Error: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">ServeJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
</code></pre></div><h2 id="用-access-token-获取用户信息"><a href="#用-access-token-获取用户信息" aria-hidden="true" class="header-anchor">#</a> 用 access_token 获取用户信息</h2> <p>这一步也是在后端做的，API 如下：</p> <div class="language-sh extra-class"><pre class="language-text"><code>GET https://api.github.com/user
</code></pre></div><p>我的博客后端代码片段如下：</p> <div class="language-go extra-class"><pre class="language-go"><code> <span class="token comment">// 获取 user info</span>
  reqUser <span class="token operator">:=</span> httplib<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.github.com/user?access_token=%s&quot;</span><span class="token punctuation">,</span> accRet<span class="token punctuation">.</span>AccessToken<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">var</span> githubUser GithubUser
  errGetUser <span class="token operator">:=</span> reqUser<span class="token punctuation">.</span><span class="token function">ToJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>githubUser<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Error: %v&quot;</span><span class="token punctuation">,</span> errGetUser<span class="token punctuation">)</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">ServeJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>因为我的博客没有做完整的用户系统，只是在评论模块想加入一个用户认证过程，防止垃圾评论。所以后面两步就直接在后端做了，直接使用从Github获取的信息注册了用户。</p> <p>完整的后端代码如下：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>UserController<span class="token punctuation">)</span> <span class="token function">LoginWithGithub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取access_token</span>
  <span class="token keyword">var</span> v <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span>
  json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>Ctx<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>RequestBody<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v<span class="token punctuation">)</span>
  code <span class="token operator">:=</span> v<span class="token punctuation">[</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">]</span>
  state <span class="token operator">:=</span> v<span class="token punctuation">[</span><span class="token string">&quot;state&quot;</span><span class="token punctuation">]</span>
  clientID <span class="token operator">:=</span> beego<span class="token punctuation">.</span>AppConfig<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;GITHUB_CLIENT_ID&quot;</span><span class="token punctuation">)</span>
  clientSecret <span class="token operator">:=</span> beego<span class="token punctuation">.</span>AppConfig<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">&quot;GITHUB_CLIENT_SECRET&quot;</span><span class="token punctuation">)</span>

  req <span class="token operator">:=</span> httplib<span class="token punctuation">.</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token string">&quot;https://github.com/login/oauth/access_token&quot;</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;client_id&quot;</span><span class="token punctuation">,</span> clientID<span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;client_secret&quot;</span><span class="token punctuation">,</span> clientSecret<span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Param</span><span class="token punctuation">(</span><span class="token string">&quot;state&quot;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>
  req<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">&quot;Accept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span>

  <span class="token keyword">var</span> accRet GithubAccessResult
  err <span class="token operator">:=</span> req<span class="token punctuation">.</span><span class="token function">ToJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>accRet<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Error: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">ServeJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 获取 user info</span>
  reqUser <span class="token operator">:=</span> httplib<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.github.com/user?access_token=%s&quot;</span><span class="token punctuation">,</span> accRet<span class="token punctuation">.</span>AccessToken<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token keyword">var</span> githubUser GithubUser
  errGetUser <span class="token operator">:=</span> reqUser<span class="token punctuation">.</span><span class="token function">ToJSON</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>githubUser<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;Error: %v&quot;</span><span class="token punctuation">,</span> errGetUser<span class="token punctuation">)</span><span class="token punctuation">)</span>
    c<span class="token punctuation">.</span><span class="token function">ServeJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 注册用户</span>
  foreignId <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;github-%d&quot;</span><span class="token punctuation">,</span> githubUser<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
  user<span class="token punctuation">,</span> errGetUser <span class="token operator">:=</span> models<span class="token punctuation">.</span><span class="token function">GetUserByForeignId</span><span class="token punctuation">(</span>foreignId<span class="token punctuation">)</span>
  <span class="token keyword">if</span> errGetUser <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token operator">||</span> user <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    user <span class="token operator">=</span> <span class="token operator">&amp;</span>models<span class="token punctuation">.</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span>
    user<span class="token punctuation">.</span>Name <span class="token operator">=</span> githubUser<span class="token punctuation">.</span>Name
    user<span class="token punctuation">.</span>Nick <span class="token operator">=</span> githubUser<span class="token punctuation">.</span>Name
    user<span class="token punctuation">.</span>AvatarUrl <span class="token operator">=</span> githubUser<span class="token punctuation">.</span>AvatarURL
    user<span class="token punctuation">.</span>Email <span class="token operator">=</span> githubUser<span class="token punctuation">.</span>Email
    user<span class="token punctuation">.</span>UserType <span class="token operator">=</span> models<span class="token punctuation">.</span>UserType_GITHUB
    user<span class="token punctuation">.</span>ForeignId <span class="token operator">=</span> foreignId
    user<span class="token punctuation">.</span>IsAdmin <span class="token operator">=</span> <span class="token boolean">false</span>
    models<span class="token punctuation">.</span><span class="token function">AddUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 设置登录 session</span>
  c<span class="token punctuation">.</span><span class="token function">SetSession</span><span class="token punctuation">(</span>utils<span class="token punctuation">.</span>TOKEN<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
  user<span class="token punctuation">.</span>Token <span class="token operator">=</span> c<span class="token punctuation">.</span>CruSession<span class="token punctuation">.</span><span class="token function">SessionID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  c<span class="token punctuation">.</span>Data<span class="token punctuation">[</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> utils<span class="token punctuation">.</span><span class="token function">NewResult</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>

  c<span class="token punctuation">.</span><span class="token function">ServeJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="最后"><a href="#最后" aria-hidden="true" class="header-anchor">#</a> 最后</h2> <p>这样整个使用 Github OAuth 登录就这样完成了，欢迎到我的博客体验： <a href="http://www.aqcoder.com" target="_blank" rel="noopener noreferrer">http://www.aqcoder.com<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><img src="https://ravenq-1251588610.cos.ap-guangzhou.myqcloud.com/ravenq-qr-gray.png" alt="ravenq"></p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.449482ac.js" defer></script><script src="/assets/js/38.9f145b9a.js" defer></script>
  </body>
</html>
